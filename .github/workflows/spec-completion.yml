name: Spec Completion Auto-Commit

on:
  workflow_dispatch:
    inputs:
      spec_name:
        description: 'Tamamlanan spec adÄ±'
        required: true
        type: string
      version_type:
        description: 'Version artÄ±rÄ±m tipi'
        required: true
        default: 'minor'
        type: choice
        options:
        - patch
        - minor
        - major

jobs:
  spec-completion:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install bump2version
    
    - name: Configure Git
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
    
    - name: Create feature branch
      run: |
        BRANCH_NAME="feature/spec-${{ inputs.spec_name }}-$(date '+%Y%m%d-%H%M%S')"
        git checkout -b $BRANCH_NAME
        echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV
    
    - name: Commit spec completion
      run: |
        git add .
        git commit -m "âœ… Spec tamamlandÄ±: ${{ inputs.spec_name }}
        
        - Spec: ${{ inputs.spec_name }}
        - Tarih: $(date '+%Y-%m-%d %H:%M:%S')
        - DeÄŸiÅŸiklikler: Yeni Ã¶zellikler ve iyileÅŸtirmeler
        
        Co-authored-by: Kiro AI <kiro@ai.com>"
    
    - name: Bump version
      run: |
        CURRENT_VERSION=$(cat VERSION 2>/dev/null || echo "0.1.0")
        bump2version ${{ inputs.version_type }} --current-version $CURRENT_VERSION
        NEW_VERSION=$(cat VERSION)
        echo "NEW_VERSION=$NEW_VERSION" >> $GITHUB_ENV
    
    - name: Push feature branch
      run: |
        git push origin $BRANCH_NAME
    
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        branch: ${{ env.BRANCH_NAME }}
        title: "ğŸš€ Spec TamamlandÄ±: ${{ inputs.spec_name }} (v${{ env.NEW_VERSION }})"
        body: |
          ## ğŸ“‹ Spec Tamamlama Raporu
          
          **Spec AdÄ±:** ${{ inputs.spec_name }}
          **Yeni Versiyon:** v${{ env.NEW_VERSION }}
          **Tamamlanma Tarihi:** $(date '+%Y-%m-%d %H:%M:%S')
          
          ### ğŸ”„ DeÄŸiÅŸiklikler
          - Spec gÃ¶revleri tamamlandÄ±
          - Kod implementasyonu yapÄ±ldÄ±
          - Testler eklendi/gÃ¼ncellendi
          
          ### âœ… Kontrol Listesi
          - [ ] Kod review yapÄ±ldÄ±
          - [ ] Testler geÃ§iyor
          - [ ] DokÃ¼mantasyon gÃ¼ncellendi
          
          **Otomatik oluÅŸturuldu:** GitHub Actions
        labels: |
          spec-completion
          enhancement
          auto-generated